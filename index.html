<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🍁 Autumn Guide: 2x Leveraged ETFs 🍂</title>
  <style>
    :root {
      --bg: #1a0e0a;           /* deep brown */
      --card: #24130f;         /* darker chestnut */
      --text: #c9bfb3;         /* softer warm beige - less bright */
      --muted: #a89885;        /* muted tan */
      --pumpkin: #d97706;      /* pumpkin orange */
      --maple: #b91c1c;        /* maple red */
      --gold: #e8a030;         /* softer golden */
      --plum: #7c3aed;         /* plum accent */
      --leaf: #92400e;         /* brown/orange */
      --ring: rgba(245, 158, 11, 0.35);
    }

    @media (prefers-color-scheme: light) {
        body { background: linear-gradient(180deg, #faf3e7, #efe3d6); color: #2a1d18; }
        .card { background: #fff3e3; border-color: rgba(185,28,28,0.15); }
        .section { background: #fff0df; }
        .raw { background: #fff3e6; color: #3b2a22; }
        .subtitle { color: #6b4f3c; }
        }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(185,28,28,0.15), transparent 60%),
        radial-gradient(1200px 800px at 110% 110%, rgba(217,119,6,0.15), transparent 60%),
        linear-gradient(180deg, #0e0705, var(--bg));
      line-height: 1.75;
      font-size: 15px;
    }

    .container {
      max-width: 1100px;
      margin: min(6vw,64px) auto;
      padding: 0 20px;
    }

    .card {
      background: linear-gradient(180deg, rgba(36,19,15,0.9), rgba(24,12,9,0.95));
      border: 1px solid rgba(245,158,11,0.15);
      box-shadow: 0 10px 30px rgba(0,0,0,0.45), inset 0 0 0 1px rgba(255,255,255,0.03);
      border-radius: 16px;
      overflow: hidden;
    }

    header.hero {
      padding: 28px 28px 16px 28px;
      background: linear-gradient(135deg, rgba(217,119,6,0.12), rgba(185,28,28,0.12) 55%, rgba(124,58,237,0.12));
      border-bottom: 1px solid rgba(245,158,11,0.18);
    }

    .title {
      margin: 0 0 6px 0;
      font-size: clamp(26px, 3.5vw, 36px);
      font-weight: 700;
      letter-spacing: 0.2px;
      color: #d4c5b5;
      text-shadow: 0 2px 4px rgba(0,0,0,0.4);
    }

    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 15px;
    }

    .badges { margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; }
    .badge {
      font-size: 12px; color: #1a0e0a; font-weight: 700;
      background: linear-gradient(180deg, var(--gold), #f59e0bbb);
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.25);
    }

    main.content { padding: 22px 22px 26px 22px; }

    .section {
      background: linear-gradient(180deg, rgba(36,19,15,0.6), rgba(24,12,9,0.6));
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 12px;
      padding: 18px;
      margin: 14px 0;
      box-shadow: 0 0 0 3px transparent, 0 8px 18px rgba(0,0,0,0.25);
    }

    .section h2, .section h3 {
      margin-top: 0;
      color: var(--gold);
      text-shadow: 0 2px 4px rgba(0,0,0,0.4);
      font-size: 1.4em;
      font-weight: 600;
    }
    
    .section h4 {
      color: #d4a960;
      font-size: 1.1em;
      font-weight: 600;
      margin-top: 1em;
    }

    .note {
      color: var(--muted);
      font-size: 14px;
      margin: 8px 0 2px 0;
      opacity: 0.9;
    }

    .raw {
      display: block;
      width: 100%;
      overflow: auto;
      background: #150b08;
      border: 1px dashed rgba(245,158,11,0.35);
      border-radius: 10px;
      padding: 16px;
      color: var(--muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      line-height: 1.5;
      white-space: pre-wrap; /* preserve content but wrap long lines */
    }

    footer {
      padding: 16px 22px 24px 22px;
      color: var(--muted);
      font-size: 13px;
      display: flex; justify-content: space-between; align-items: center;
      border-top: 1px solid rgba(245,158,11,0.18);
      background: linear-gradient(180deg, rgba(217,119,6,0.08), rgba(185,28,28,0.08));
    }

    .cta {
      display: inline-block;
      background: linear-gradient(180deg, #efb43a, var(--gold));
      color: #1a0e0a; font-weight: 800;
      padding: 8px 14px; border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.25);
      box-shadow: 0 4px 10px rgba(245,158,11,0.25);
      text-decoration: none;
    }

    @media (prefers-color-scheme: light) {
      body { background: linear-gradient(180deg, #fdf7ef, #f2e6d8); color: #1b120f; }
      .card { background: #fff7ef; border-color: rgba(185,28,28,0.15); }
      .section { background: #fff5ea; }
      .raw { background: #fff8f0; color: #3b2a22; }
      .subtitle { color: #6b4f3c; }
    }

    /* Golden simmering wave */
    @keyframes goldenWave {
      0%   { background-position: 120% 0, 0 0; }
      50%  { background-position: -20% 0, 0 0; }
      75%  { background-position: -20% 0, 0 0; }
      100% { background-position: 120% 0, 0 0; }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .section { animation: none !important; }
      .section > h2, .section > h3 { animation: none !important; }
    }

    /* Animated gold effect on section titles */
    .section  {
      position: relative;
      padding: 2px 8px;
      border-radius: 8px;
      background:
        linear-gradient(60deg,
          rgba(242,164,21,0) 0%,
          rgba(242,164,21,0.10) 20%,
          rgba(242,164,21,0.18) 50%,
          rgba(242,164,21,0.10) 80%,
          rgba(242,164,21,0) 100%
        );
      background-size: 300% 100%;
      background-repeat: no-repeat;
      animation: goldenWave 15s ease-in-out infinite;
    }


    header.hero {
      background: linear-gradient(
        135deg,
        rgba(242,164,21,0.10),
        rgba(185,28,28,0.10) 55%,
        rgba(124,58,237,0.10)
      );
    }

    /* Black shade 20% alpha for all content except headers */
    p, ul, ol, li, table, tr, td, th, .note, .raw, .badge, .subtitle, footer, .cta {
      background-color: rgba(0, 0, 0, 0.25);
      padding: 8px;
      border-radius: 6px;
    }
    
    p, li {
      font-size: 15px;
      line-height: 1.7;
    }
    
    strong {
      color: #d9c9b5;
      font-weight: 600;
    }
    
    a {
      color: #f0b050;
      text-decoration: none;
      border-bottom: 1px solid rgba(240, 176, 80, 0.3);
    }
    
    a:hover {
      color: #ffca6a;
      border-bottom-color: rgba(255, 202, 106, 0.6);
    }

    /* Reset padding for inline elements to avoid excessive spacing */
    li, td, th {
      padding: 4px 8px;
    }

    .badge {
      padding: 6px 10px; /* Restore original badge padding */
    }

    /* Decision matrix table - make Rationale column 4x wider */
    #decision-matrix table th:nth-child(9),
    #decision-matrix table td:nth-child(9) {
      min-width: 400px;
      width: 40%;
    }


  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header class="hero">
        <h1 class="title">🍁 Autumn Report • 2x Leveraged ETFs 🍂</h1>
        <p class="subtitle">A seasonal-styled rendering of your write-up with cozy fall tones, crisp typography, and helpful emojis.</p>
        <section class="section" id="paper-trader">
          <h3>📊 Paper Trader App Simulator</h3>
          <p>Track your paper trades with this interactive journal. Add trades, pair buys with sells, and monitor your performance.</p>
          
          <div style="margin: 15px 0; display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="downloadTrades()" style="padding: 8px 16px; background: rgba(74,222,128,0.2); color: #4ade80; border: 1px solid #4ade80; border-radius: 6px; cursor: pointer; font-weight: 600;">📥 Download JSON</button>
            <button onclick="document.getElementById('fileInput').click()" style="padding: 8px 16px; background: rgba(232,160,48,0.2); color: var(--gold); border: 1px solid var(--gold); border-radius: 6px; cursor: pointer; font-weight: 600;">📤 Upload JSON</button>
            <input type="file" id="fileInput" accept=".json,.txt" style="display: none;" onchange="uploadTrades(event)">
            <button onclick="clearAllTrades()" style="padding: 8px 16px; background: rgba(248,113,113,0.2); color: #f87171; border: 1px solid #f87171; border-radius: 6px; cursor: pointer; font-weight: 600;">🗑️ Clear All</button>
          </div>

          <div id="trade-form" style="margin: 20px 0;">
            <h4>➕ Add New Trade</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 10px;">
              <input type="text" id="ticker" placeholder="Ticker (e.g., MSTU)" style="padding: 8px; border-radius: 6px; border: 1px solid rgba(245,158,11,0.3); background: rgba(0,0,0,0.3); color: var(--text);">
              <select id="action" style="padding: 8px; border-radius: 6px; border: 1px solid rgba(245,158,11,0.3); background: rgba(0,0,0,0.3); color: var(--text);">
                <option value="BUY">BUY</option>
                <option value="SELL">SELL</option>
              </select>
              <input type="number" id="shares" placeholder="Shares" step="1" style="padding: 8px; border-radius: 6px; border: 1px solid rgba(245,158,11,0.3); background: rgba(0,0,0,0.3); color: var(--text);">
              <input type="number" id="price" placeholder="Price" step="0.01" style="padding: 8px; border-radius: 6px; border: 1px solid rgba(245,158,11,0.3); background: rgba(0,0,0,0.3); color: var(--text);">
              <input type="date" id="date" style="padding: 8px; border-radius: 6px; border: 1px solid rgba(245,158,11,0.3); background: rgba(0,0,0,0.3); color: var(--text);">
            </div>
            <textarea id="notes" placeholder="Notes (optional)" rows="2" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(245,158,11,0.3); background: rgba(0,0,0,0.3); color: var(--text); margin-bottom: 10px;"></textarea>
            <button onclick="addTrade()" style="padding: 10px 20px; background: linear-gradient(180deg, #efb43a, var(--gold)); color: #1a0e0a; font-weight: 700; border: none; border-radius: 8px; cursor: pointer;">Add Trade</button>
          </div>

          <div id="trades-container" style="margin-top: 20px;">
            <h4>📋 Trade Journal</h4>
            <div id="trades-list"></div>
          </div>

          <div id="summary" style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.4); border-radius: 8px; border: 1px solid rgba(245,158,11,0.2);">
            <h4>💰 Portfolio Summary</h4>
            <div id="summary-content"></div>
          </div>
        </section>
      </header>
    </div>
    <main class="content">
      <!-- TITLE + METADATA -->
      <section class="section" id="meta">
        <h2>🍁 Educational Guide to 2x Long Leveraged ETFs</h2>
        <p><strong>Prepared by:</strong> Grok 4, xAI</p>
        <p><strong>Date:</strong> October 01, 2025</p>
        <p>The guide integrates discussions on 2x long ETFs, including definitions, use cases, holding periods, projections, and practical considerations for trading with Ally Invest, drawing from prior analyses.</p>
      </section>
    
      <!-- ABSTRACT -->
      <section class="section" id="abstract">
        <h2>📜 Abstract</h2>
        <p>This educational guide provides a comprehensive overview of 2x long leveraged exchange-traded funds (ETFs), focusing on their mechanics, risks, and practical applications for short-term trading. Inspired by ABET accreditation standards, it emphasizes student (or learner) outcomes such as understanding volatility decay, risk management, and ethical trading practices. The report explains why leveraged ETFs are suitable only for short-term strategies, offers a simulated use case with Tesla stock, projects performance under volatility, and addresses trading logistics with Ally Invest. Key sections include the purpose (why), detailed solutions, frequently asked questions, misconceptions, a glossary, and references. By October 2025, with market volatility influenced by economic factors, this guide aims to equip investors with knowledge to avoid common pitfalls, supported by data from sources like GraniteShares and Fidelity Investments [0][7]. ⚠️ The primary outcome is to foster informed decision-making, reducing the risk of financial loss from misuse of leveraged products.</p>
      </section>
    
      <!-- INTRODUCTION -->
      <section class="section" id="introduction">
        <h2>📖 Introduction: Why This Guide?</h2>
        <p>Leveraged ETFs, particularly 2x long variants, have gained popularity among retail investors seeking amplified returns in bullish markets. However, ⚡ their daily reset mechanism often leads to volatility decay, making them unsuitable for long-term holding and resulting in significant underperformance over time [2][3][5]. This guide addresses the educational need for clear, evidence-based information on these instruments, especially in a volatile 2025 market environment marked by interest rate fluctuations and geopolitical events.</p>
        <p>The purpose aligns with ABET-like educational objectives: to promote “student outcomes” such as applying mathematical models to financial projections (e.g., compounding effects), evaluating ethical risks in high-leverage trading, and demonstrating continuous improvement through risk management strategies [22][23]. Why now? As of October 01, 2025, retail trading platforms like Ally Invest have expanded access to these products, but without proper education, 📉 investors face amplified losses—evidenced by historical data where leveraged ETFs decayed by 10-20% in flat but volatile periods [1][6]. This report provides a solution by synthesizing practical guidance, simulations, and references to empower learners, akin to an engineering curriculum’s focus on problem-solving and safety.</p>
      </section>
    
      <!-- SOLUTION OVERVIEW -->
      <section class="section" id="solution">
        <h2>🧭 Solution: Comprehensive Guide to 2x Long ETFs</h2>
    
        <h3 id="what-is">What is a 2x Long ETF?</h3>
        <p>A 2x long exchange-traded fund (ETF) is a leveraged investment product designed to provide 📈 twice (2x) the daily performance of an underlying asset or index, such as the S&amp;P 500 [4][7].</p>
        <ul>
          <li>If the underlying index rises 1% in a single trading day, the 2x ETF aims to rise about 2% (before fees and expenses).</li>
          <li>If the index falls 1%, the ETF aims to fall about 2%.</li>
        </ul>
        <p>These ETFs use financial derivatives (like swaps and futures) to achieve this leverage, and they reset daily. This ⏰ means the leverage applies only to each day’s return, not over multiple days [2]. They’re popular for short-term trading to amplify potential gains (or losses) but are not meant for buy-and-hold investing due to <em>volatility decay</em> (or beta slippage), where compounding effects in volatile markets can erode returns over time—even if the underlying trends upward [3][5][6].</p>
        <p><strong>⚠️ Key risks:</strong> Higher volatility, potential for amplified losses, management fees (often 0.9–1.5% annually), and tracking errors [0][8].</p>
    
        <h3 id="use-case">Use Case: Short-Term Bullish Trade on Earnings News</h3>
        
        <h4>Example 1: Tesla (TSLA)</h4>
        <p>Imagine you're bullish on 🚗 Tesla (TSLA) ahead of its quarterly earnings on October 23, 2025, expecting a strong beat and positive guidance that may drive TSLA up 3–5% in after-hours and the next day [1].</p>
        <ul>
          <li><strong>🎯 Strategy:</strong> Buy Direxion Daily TSLA Bull 2X Shares (TSLL) at market open on Oct 24, targeting a quick 4–6% gain.</li>
          <li><strong>Entry:</strong> $50/share at open (assuming TSLA opens +2%).</li>
          <li><strong>Target:</strong> $53/share if TSLA hits +2.5% intraday.</li>
          <li><strong>🛑 Stop-loss:</strong> $48 if TSLA drops 2%.</li>
          <li><strong>Why 2x?</strong> Amplifies short-term conviction without options complexity.</li>
          <li><strong>💰 Outcome example:</strong> If TSLA +3%, TSLL ~+6% ($3 profit/share). If -3%, ~-6%—size small (1–2% of portfolio).</li>
        </ul>
        
        <h4>Example 2: MicroStrategy (MSTR)</h4>
        <p>Imagine you're bullish on 📊 MicroStrategy (MSTR) ahead of a Bitcoin rally or company announcement on October 23, 2025, expecting positive momentum that may drive MSTR up 3–5% in after-hours and the next day [1].</p>
        <ul>
          <li><strong>🎯 Strategy:</strong> Buy Defiance Daily Target 2X Long MSTR ETF (MSTU) at market open on Oct 24, targeting a quick 4–6% gain.</li>
          <li><strong>Entry:</strong> $45/share at open (assuming MSTR opens +2%).</li>
          <li><strong>Target:</strong> $47.70/share if MSTR hits +2.5% intraday.</li>
          <li><strong>🛑 Stop-loss:</strong> $43.20 if MSTR drops 2%.</li>
          <li><strong>Why 2x?</strong> Amplifies short-term conviction without options complexity.</li>
          <li><strong>💰 Outcome example:</strong> If MSTR +3%, MSTU ~+6% ($2.70 profit/share). If -3%, ~-6%—size small (1–2% of portfolio).</li>
        </ul>
        
        <p><em>⚠️ This is speculative; always use risk management [0][9].</em></p>
    
        <h3 id="holding-period">How Long Should You Hold a 2x Long ETF?</h3>
        <ul>
          <li><strong>✅ Ideal:</strong> 1 day (or intraday). Best for short-term directional bets due to daily reset.</li>
          <li><strong>1–5 days:</strong> Okay if the market trends strongly with low volatility; monitor daily.</li>
          <li><strong>1–4 weeks:</strong> Risky—decay compounds; only with active management and low volatility.</li>
          <li><strong>🚫 &gt;1 month:</strong> Generally avoid—leveraged ETFs often lag 2x the index over months [1][6].</li>
        </ul>
        <p><strong>💡 Rule of thumb:</strong> Reassess daily; exit if thesis changes or decay bites. Use tactically, not as core holdings [5][7].</p>
      </section>
    
      <!-- PROJECTION TABLE -->
      <section class="section" id="projection">
        <h2>📊 Projection: Volatility Decay Simulation</h2>
        <p>Alternating +5% and −5% daily returns over 20 trading days, starting from $1. 📉 Underlying ends slightly down; 2x decays faster due to compounding [2][6].</p>
        <table>
          <tr>
            <th>Day</th><th>Underlying Return (%)</th><th>2x Return (%)</th><th>Underlying Cumulative</th><th>2x Cumulative</th>
          </tr>
          <tr><td>1</td><td>5.0</td><td>10.0</td><td>1.0500</td><td>1.1000</td></tr>
          <tr><td>2</td><td>-5.0</td><td>-10.0</td><td>0.9975</td><td>0.9900</td></tr>
          <tr><td>3</td><td>5.0</td><td>10.0</td><td>1.0474</td><td>1.0890</td></tr>
          <tr><td>4</td><td>-5.0</td><td>-10.0</td><td>0.9950</td><td>0.9801</td></tr>
          <tr><td>5</td><td>5.0</td><td>10.0</td><td>1.0448</td><td>1.0781</td></tr>
          <tr><td>6</td><td>-5.0</td><td>-10.0</td><td>0.9925</td><td>0.9703</td></tr>
          <tr><td>7</td><td>5.0</td><td>10.0</td><td>1.0421</td><td>1.0673</td></tr>
          <tr><td>8</td><td>-5.0</td><td>-10.0</td><td>0.9900</td><td>0.9606</td></tr>
          <tr><td>9</td><td>5.0</td><td>10.0</td><td>1.0395</td><td>1.0567</td></tr>
          <tr><td>10</td><td>-5.0</td><td>-10.0</td><td>0.9876</td><td>0.9510</td></tr>
          <tr><td>11</td><td>5.0</td><td>10.0</td><td>1.0369</td><td>1.0461</td></tr>
          <tr><td>12</td><td>-5.0</td><td>-10.0</td><td>0.9851</td><td>0.9415</td></tr>
          <tr><td>13</td><td>5.0</td><td>10.0</td><td>1.0343</td><td>1.0356</td></tr>
          <tr><td>14</td><td>-5.0</td><td>-10.0</td><td>0.9826</td><td>0.9321</td></tr>
          <tr><td>15</td><td>5.0</td><td>10.0</td><td>1.0318</td><td>1.0253</td></tr>
          <tr><td>16</td><td>-5.0</td><td>-10.0</td><td>0.9802</td><td>0.9227</td></tr>
          <tr><td>17</td><td>5.0</td><td>10.0</td><td>1.0292</td><td>1.0150</td></tr>
          <tr><td>18</td><td>-5.0</td><td>-10.0</td><td>0.9777</td><td>0.9135</td></tr>
          <tr><td>19</td><td>5.0</td><td>10.0</td><td>1.0266</td><td>1.0049</td></tr>
          <tr><td>20</td><td>-5.0</td><td>-10.0</td><td>0.9753</td><td>0.9044</td></tr>
        </table>
        <h3>Key Insights from Projection</h3>
        <ul>
          <li>⚠️ After 20 days: Underlying down 2.47%; 2x down 9.56% (worse than 2x the loss due to decay) [3].</li>
          <li>📈 In a steady uptrend (e.g., +0.5% daily), 2x would outperform (~+1% daily compounded). Volatility amplifies erosion [2][5].</li>
          <li>If plotted: underlying zigzags near 1.0; 2x trends lower, diverging after ~5–10 days.</li>
        </ul>
      </section>
    
      <!-- DECISION MATRIX -->
      <section class="section" id="decision-matrix">
        <h2>🎯 Decision Matrix: When to Buy, When to Leverage</h2>
        <p>This matrix integrates key indicators—Bitcoin (BTC), IBIT (BlackRock Bitcoin ETF), MicroStrategy (MSTR), and M2 Money Supply—to guide buying and leveraging decisions. Each scenario represents a different market condition with specific action recommendations.</p>
        
        <h3>📊 Key Indicators Explained</h3>
        <ul>
          <li><strong>₿ BTC (Bitcoin):</strong> Leading indicator for crypto-correlated assets; MSTR holds ~152,800+ BTC (as of Oct 2025), making it highly sensitive to Bitcoin price movements.</li>
          <li><strong>🏦 IBIT (iShares Bitcoin Trust):</strong> BlackRock's spot Bitcoin ETF; institutional money flow indicator. High volume = strong institutional interest.</li>
          <li><strong>📊 MSTR (MicroStrategy):</strong> Bitcoin proxy stock with ~2-3x Bitcoin beta; often leads or lags BTC by hours/days.</li>
          <li><strong>💵 M2 Money Supply:</strong> Broad money supply metric; expansion (↑) = liquidity-driven rallies; contraction (↓) = risk-off environment.</li>
        </ul>

        <h3>🧭 Decision Matrix: 8 Scenarios</h3>
        <table>
          <tr>
            <th>Scenario</th>
            <th>BTC Trend</th>
            <th>IBIT Flow</th>
            <th>MSTR vs BTC</th>
            <th>M2 Supply</th>
            <th>Market Outlook</th>
            <th>Action</th>
            <th>Leverage?</th>
            <th>Rationale</th>
          </tr>
          
          <tr>
            <td><strong>1. 🚀 Bull Rocket</strong></td>
            <td>📈 +5-10% week</td>
            <td>✅ Heavy inflows</td>
            <td>MSTR outpacing BTC</td>
            <td>↑ Expanding</td>
            <td>🟢 Strong Bull</td>
            <td><strong>BUY MSTR + MSTU</strong></td>
            <td>✅ YES (2x)</td>
            <td>All signals aligned: institutional demand (IBIT), liquidity (M2), and MSTR leading = high conviction. Use MSTU for 1-3 day swing. Target: +6-12% on MSTU.</td>
          </tr>
          
          <tr>
            <td><strong>2. 📈 Steady Climb</strong></td>
            <td>📈 +2-3% week</td>
            <td>✅ Moderate inflows</td>
            <td>MSTR tracking BTC</td>
            <td>→ Stable</td>
            <td>🟢 Moderate Bull</td>
            <td><strong>BUY MSTR (unleveraged)</strong></td>
            <td>⚠️ MAYBE (1-2 days max)</td>
            <td>Positive but not explosive. MSTR safer than MSTU here. If using MSTU, exit same day or next day. Low volatility = less decay risk.</td>
          </tr>
          
          <tr>
            <td><strong>3. 🌊 Choppy Waters</strong></td>
            <td>↔️ Flat (±2%)</td>
            <td>↔️ Mixed flows</td>
            <td>MSTR lagging BTC</td>
            <td>→ Stable</td>
            <td>🟡 Neutral/Volatile</td>
            <td><strong>AVOID or WAIT</strong></td>
            <td>🚫 NO</td>
            <td>High volatility + no clear direction = volatility decay will erode MSTU. MSTR lagging suggests weak sentiment. Cash is a position.</td>
          </tr>
          
          <tr>
            <td><strong>4. 🔥 FOMO Peak</strong></td>
            <td>📈 +15%+ week</td>
            <td>⚠️ Extreme inflows</td>
            <td>MSTR 20%+ above BTC</td>
            <td>↑ Expanding</td>
            <td>🔴 Overheated</td>
            <td><strong>TAKE PROFITS or AVOID</strong></td>
            <td>🚫 NO (or inverse)</td>
            <td>MSTR significantly outpacing BTC = overextension risk. Parabolic moves often reverse sharply. If holding, sell. If not, wait for pullback or consider MSTZ (inverse) for 1-day short.</td>
          </tr>
          
          <tr>
            <td><strong>5. 📉 Bear Slide</strong></td>
            <td>📉 -5-8% week</td>
            <td>❌ Heavy outflows</td>
            <td>MSTR tracking BTC down</td>
            <td>↓ Contracting</td>
            <td>🔴 Bear Market</td>
            <td><strong>AVOID or SHORT</strong></td>
            <td>🚫 NO (or inverse 1x)</td>
            <td>All indicators negative. MSTU will amplify losses (-10-16%). Stay cash or use MSTZ (inverse) cautiously for 1-day trades. M2 contraction = liquidity drain.</td>
          </tr>
          
          <tr>
            <td><strong>6. 🔄 Reversal Setup</strong></td>
            <td>📉 -10%+ week</td>
            <td>✅ Inflows resuming</td>
            <td>MSTR bottoming vs BTC</td>
            <td>↑ Starting to expand</td>
            <td>🟡 Potential Bottom</td>
            <td><strong>SCALE IN MSTR (small)</strong></td>
            <td>⚠️ NO (wait for confirmation)</td>
            <td>Contrarian setup: IBIT inflows + M2 expansion = smart money buying dip. Start with unleveraged MSTR. If BTC +3-5% next day, add MSTU for bounce (1-2 days max).</td>
          </tr>
          
          <tr>
            <td><strong>7. 💎 Accumulation Zone</strong></td>
            <td>↔️ Consolidating</td>
            <td>✅ Steady inflows</td>
            <td>MSTR at discount to BTC</td>
            <td>↑ Expanding slowly</td>
            <td>🟢 Bullish Setup</td>
            <td><strong>BUY MSTR (DCA)</strong></td>
            <td>⚠️ WAIT for breakout</td>
            <td>MSTR trading below fair value vs BTC holdings = value opportunity. Accumulate unleveraged. When BTC breaks resistance, switch to MSTU for 1-3 day momentum trade.</td>
          </tr>
          
          <tr>
            <td><strong>8. 🌪️ Black Swan</strong></td>
            <td>📉 -20%+ crash</td>
            <td>❌ Panic outflows</td>
            <td>MSTR -30%+ vs BTC</td>
            <td>↓ Contracting sharply</td>
            <td>🔴 Crisis</td>
            <td><strong>CASH / WAIT</strong></td>
            <td>🚫 NEVER</td>
            <td>Systemic risk event (e.g., exchange hack, regulatory ban). MSTU could lose 40-60% in days. Preserve capital. Re-enter only after stabilization (3-5 days of lower volatility).</td>
          </tr>
          
          <tr>
            <td colspan="9"><strong>🏦 Q4 Saylor ATM Scenarios (MSTR Price Stability Effect)</strong></td>
          </tr>
          
          <tr>
            <td><strong>9. 🏦 ATM Dilution Drag</strong></td>
            <td>📈 +8% week</td>
            <td>✅ Strong inflows</td>
            <td>MSTR flat despite BTC rally</td>
            <td>↑ Expanding</td>
            <td>🟡 Suppressed by ATM</td>
            <td><strong>AVOID MSTR/MSTU</strong></td>
            <td>🚫 NO</td>
            <td>Saylor's ATM offering dilutes shares to buy more BTC, keeping MSTR price stable while BTC rises. MSTU won't capture BTC gains. Better to buy BTC directly, IBIT, or GBTC. Wait for ATM to pause (check SEC filings for completion).</td>
          </tr>
          
          <tr>
            <td><strong>10. 🎯 ATM Completion Pop</strong></td>
            <td>📈 +3% week</td>
            <td>✅ Moderate inflows</td>
            <td>MSTR announces ATM complete</td>
            <td>↑ Expanding</td>
            <td>🟢 Bullish Catalyst</td>
            <td><strong>BUY MSTU immediately</strong></td>
            <td>✅ YES (2x, 1-3 days)</td>
            <td>ATM completion removes dilution overhang. MSTR often rallies 5-10% in 1-2 days as beta to BTC normalizes. Enter MSTU on announcement, target +8-12% in 2-3 days. Watch for profit-taking after initial pop. Set tight stop at -3%.</td>
          </tr>
          
          <tr>
            <td><strong>11. 📊 NAV Discount Opportunity</strong></td>
            <td>↔️ Flat</td>
            <td>↔️ Mixed flows</td>
            <td>MSTR 15%+ below BTC NAV</td>
            <td>→ Stable</td>
            <td>🟢 Value Play</td>
            <td><strong>BUY MSTR (unleveraged)</strong></td>
            <td>⚠️ NO (wait for catalyst)</td>
            <td>ATM selling creates temporary discount to Net Asset Value (BTC holdings). MSTR trading significantly below fair value = accumulation opportunity. Buy unleveraged MSTR, hold 2-4 weeks. When ATM ends or BTC rallies, discount typically closes. Avoid MSTU until momentum confirmed.</td>
          </tr>
          
          <tr>
            <td><strong>12. 🔄 BTC Rally + ATM Active</strong></td>
            <td>📈 +12% week</td>
            <td>✅ Heavy inflows</td>
            <td>MSTR +4% (lagging badly)</td>
            <td>↑ Expanding</td>
            <td>🟡 Frustrating Lag</td>
            <td><strong>BUY IBIT instead</strong></td>
            <td>🚫 NO on MSTU</td>
            <td>Strong BTC rally but MSTR underperforms due to ongoing ATM dilution. MSTU will only capture muted MSTR gains (~+8% vs BTC +24%). Better to buy IBIT (1:1 BTC exposure) or wait for ATM pause. Track MicroStrategy's 8-K filings for ATM progress—typically $500M-$2B programs over 4-8 weeks.</td>
          </tr>
          
          <tr>
            <td><strong>13. 💎 Post-ATM Accumulation</strong></td>
            <td>↔️ Consolidating</td>
            <td>✅ Inflows resuming</td>
            <td>MSTR NAV discount narrowing</td>
            <td>↑ Expanding</td>
            <td>🟢 Re-rating Phase</td>
            <td><strong>BUY MSTR, scale into MSTU</strong></td>
            <td>⚠️ YES (cautiously, 1-2 days)</td>
            <td>1-2 weeks post-ATM: MSTR beta to BTC normalizing, discount closing. Start with unleveraged MSTR. If BTC +3% and MSTR +5-6% (2x beta returning), add MSTU for short swings. Monitor for 3+ days of normal correlation before committing to leverage. Exit MSTU if beta drops below 1.5x again.</td>
          </tr>
          
          <tr>
            <td><strong>14. 🚨 ATM + BTC Dump</strong></td>
            <td>📉 -6% week</td>
            <td>❌ Outflows</td>
            <td>MSTR -10% (amplified drop)</td>
            <td>↓ Contracting</td>
            <td>🔴 Double Whammy</td>
            <td><strong>AVOID / CASH</strong></td>
            <td>🚫 NEVER</td>
            <td>Worst scenario: BTC falling while ATM dilutes. MSTR drops harder than BTC (negative beta amplification). MSTU could lose 15-20% in days. Absolutely avoid. If holding, exit immediately. Consider MSTZ (inverse) only if you're experienced with shorts. Better to wait 5-7 days for stabilization before re-entering.</td>
          </tr>
        </table>

        <h3>🏦 Understanding Saylor's ATM Strategy</h3>
        <p><strong>What is an ATM (At-The-Market) Offering?</strong> MicroStrategy periodically sells shares "at-the-market" to raise capital for buying more Bitcoin. This dilutes existing shareholders but increases BTC holdings per share over time.</p>
        <ul>
          <li><strong>📊 Typical Size:</strong> $500M to $2B programs, executed over 4-12 weeks in Q4 2025.</li>
          <li><strong>⚖️ Effect on MSTR:</strong> Suppresses price during active selling (Scenarios 9, 12, 14). Creates NAV discount opportunities (Scenario 11).</li>
          <li><strong>🎯 Post-ATM Catalyst:</strong> Once complete, MSTR often rallies as dilution overhang lifts (Scenario 10).</li>
          <li><strong>📈 Long-term Bullish:</strong> Increases BTC/share, but short-term bearish for price action.</li>
          <li><strong>🔍 How to Track:</strong> Monitor <a href="https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK=0001050446&type=8-K&dateb=&owner=exclude&count=100" target="_blank">SEC Form 8-K filings</a> (search "MicroStrategy" on <a href="https://www.sec.gov/edgar/searchedgar/companysearch.html" target="_blank">sec.gov</a>). <a href="https://twitter.com/saylor" target="_blank">Michael Saylor</a> often tweets updates on BTC purchases.</li>
        </ul>
        
        <h4>📚 Key Resources for Decision Matrix Indicators</h4>
        <ul>
          <li><strong>₿ Bitcoin Price:</strong> <a href="https://www.coinbase.com/price/bitcoin" target="_blank">Coinbase</a>, <a href="https://www.tradingview.com/symbols/BTCUSD/" target="_blank">TradingView</a></li>
          <li><strong>🏦 IBIT Flows:</strong> <a href="https://farside.co.uk/btc/" target="_blank">Farside Investors</a> (daily ETF flow data), <a href="https://www.bloomberg.com/quote/IBIT:US" target="_blank">Bloomberg IBIT</a></li>
          <li><strong>💵 M2 Money Supply:</strong> <a href="https://fred.stlouisfed.org/series/M2SL" target="_blank">FRED M2 Data</a> (Federal Reserve Economic Data)</li>
          <li><strong>📊 MSTR Holdings:</strong> <a href="https://www.microstrategy.com/en/bitcoin" target="_blank">MicroStrategy Bitcoin Tracker</a>, <a href="https://saylortracker.com/" target="_blank">Saylor Tracker</a></li>
          <li><strong>📉 VIX (Volatility):</strong> <a href="https://www.cboe.com/tradable_products/vix/" target="_blank">CBOE VIX Index</a></li>
          <li><strong>📰 News & Filings:</strong> <a href="https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK=0001050446&owner=exclude&count=100" target="_blank">MicroStrategy SEC Filings</a></li>
        </ul>

        <h3>🎓 Rules of Thumb Summary</h3>
        <ul>
          <li><strong>✅ Use MSTU (2x leverage) when:</strong> BTC trending up +3-5% daily, IBIT inflows strong, MSTR leading/tracking BTC, M2 expanding, VIX &lt;20. Hold 1-3 days max.</li>
          <li><strong>⚠️ Use MSTR (unleveraged) when:</strong> Moderate uptrend, mixed signals, or accumulation phase. Lower risk, can hold weeks if thesis intact.</li>
          <li><strong>🚫 AVOID leverage when:</strong> BTC choppy (±2% daily), MSTR lagging BTC significantly, M2 contracting, VIX &gt;25, or after parabolic moves (+15% week).</li>
          <li><strong>📊 Monitor correlations:</strong> MSTR typically has 2-3x Bitcoin beta. If MSTR moves &lt;1.5x BTC, it's lagging (weak). If &gt;3x, it's overheated (risky).</li>
          <li><strong>💵 M2 as macro filter:</strong> Rising M2 (check FRED data) = tailwind for risk assets. Falling M2 = reduce exposure, favor cash/stablecoins.</li>
          <li><strong>🏦 IBIT as sentiment gauge:</strong> Check daily flows (Bloomberg/Farside data). 3+ days of inflows = bullish. 3+ days outflows = bearish.</li>
        </ul>

        <h3>📈 Practical Example: Applying the Matrix</h3>
        <p><strong>Date:</strong> October 15, 2025</p>
        <ul>
          <li>₿ <strong>BTC:</strong> $67,500 → $71,200 (+5.5% in 3 days)</li>
          <li>🏦 <strong>IBIT:</strong> $850M inflows over 3 days (strong institutional buying)</li>
          <li>📊 <strong>MSTR:</strong> $385 → $420 (+9.1% = 1.65x BTC move, healthy tracking)</li>
          <li>💵 <strong>M2:</strong> Up 0.8% month-over-month (expanding liquidity)</li>
          <li>📉 <strong>VIX:</strong> 16 (low volatility)</li>
        </ul>
        <p><strong>🎯 Decision:</strong> <em>Scenario 1 (Bull Rocket)</em> — Buy MSTU at open on Oct 16. Entry: $52. Target: $55.12 (+6% if MSTR +3%). Stop-loss: $49.92 (-4% if MSTR -2%). Hold 1-2 days, exit if BTC stalls or IBIT flows reverse.</p>
      </section>
    
      <!-- CONSIDERATIONS -->
      <section class="section" id="considerations">
        <h2>🧠 Additional Considerations</h2>
        <table>
          <tr><th>Consideration</th><th>Description</th><th>Impact on 2x Long Holding</th></tr>
          <tr><td>⚡ Volatility Decay</td><td>Daily resets compound losses more than gains in choppy markets.</td><td>High—Shorten hold to 1–3 days in volatile periods (VIX &gt;20) [2][3].</td></tr>
          <tr><td>Compounding Effect</td><td>Gains/losses apply to the previous day’s leveraged value.</td><td>Medium—Favors strong trends; hurts sideways moves [6].</td></tr>
          <tr><td>Fees &amp; Expenses</td><td>Annual expense ratios ~1%, plus swap costs.</td><td>Medium—Erodes returns faster on longer holds (&gt;1 week) [0].</td></tr>
          <tr><td>Liquidity</td><td>Trade like stocks, but spreads widen in stress.</td><td>Low—Fine for daily trades; check volume &gt;1M shares/day [7].</td></tr>
          <tr><td>Market Direction</td><td>Best in bullish, low-vol environments.</td><td>High—Exit if bearish signals emerge [1].</td></tr>
          <tr><td>⚖️ Position Sizing</td><td>Leverage doubles risk.</td><td>High—Limit to 5–10% of portfolio per trade [9].</td></tr>
          <tr><td>Taxes</td><td>Short-term gains taxed as ordinary income.</td><td>Medium—Consider in taxable accounts only for quick flips [5].</td></tr>
        </table>
      </section>
    
      <!-- FAQ -->
      <section class="section" id="faq">
        <h2>❓ Frequently Asked Questions</h2>
        <p><strong>What is volatility decay?</strong> It’s ⚡ the erosion of returns in leveraged ETFs due to daily compounding in volatile markets, even if the underlying is flat [2][3][6].</p>
        <p><strong>Can I hold a 2x ETF long-term?</strong> 🚫 No, recommended for 1 day only; longer holds amplify decay [1][5].</p>
        <p><strong>How does Ally handle overnight orders?</strong> Market orders queue for next open, but use limits to avoid poor fills [14][18].</p>
        <p><strong>Are there fees for leveraged ETFs on Ally?</strong> 💵 $0 commissions for ETFs, but expense ratios apply [10].</p>
        <p><strong>What’s a good alternative to 2x ETFs?</strong> Unleveraged ETFs or options for less risk [4][7].</p>
      </section>
    
      <!-- GLOSSARY -->
      <section class="section" id="glossary">
        <h2>📚 Glossary of Nomenclature</h2>
        <p><strong>2x Long ETF:</strong> A fund aiming for twice the daily return of an index (e.g., UPRO for S&amp;P 500) [4].</p>
        <p><strong>⚡ Volatility Decay (Beta Slippage):</strong> Return erosion from daily compounding in volatile conditions [2][3].</p>
        <p><strong>⏰ Daily Reset:</strong> Rebalancing of leverage at end of each trading day [5][7].</p>
        <p><strong>Slippage:</strong> Difference between expected and actual execution price [14].</p>
        <p><strong>Extended Hours Trading:</strong> Trading outside 9:30 AM–4:00 PM ET, with limited liquidity [10][18].</p>
        <p><strong>Limit Order:</strong> Order to buy/sell at a specified price or better [13][16].</p>
        <p><strong>Market Order:</strong> Order to buy/sell immediately at current price [12][15].</p>
        <p><strong>VIX:</strong> Volatility index measuring market fear [1].</p>
      </section>
    
      <!-- REFERENCES -->
      <section class="section" id="references">
        <h2>🔗 References</h2>
        <ol>
          <li>[0] GraniteShares. (2025, June 30). A Comprehensive Guide to 2x Leveraged ETFs for Investors. https://graniteshares.com/institutional/us/en-us/research/a-comprehensive-guide-to-2x-leveraged-etfs-for-investors/</li>
          <li>[1] StockTitan. (2025). Complete Guide to 2x and 3x ETFs. https://www.stocktitan.net/articles/leveraged-etfs-how-they-work</li>
          <li>[2] Crystal Capital Partners. (2024, May 31). Why Do Leveraged ETFs Decay? https://www.crystalfunds.com/insights/leveraged-etfs-decay-understanding-mechanics-and-risks</li>
          <li>[3] Leveraged-ETFs.com. Leveraged ETF Decay Explained. https://www.leveraged-etfs.com/education/decay</li>
          <li>[4] Chase. (2025, May 5). Inverse, Leveraged and Volatility ETFs. https://www.chase.com/personal/investments/learning-and-insights/article/inversed-vs-leveraged-vs-volatile-etfs</li>
          <li>[5] Saxo. Advanced ETF Strategies. https://www.home.saxo/learn/guides/etfs/advanced-etf-strategies</li>
          <li>[6] Medium. (2024, March 13). A Complete Guide to the Power of Leveraged ETFs. https://medium.com/limitless-investor/a-complete-guide-to-the-power-of-leveraged-etfs-debunking-myths-and-backed-by-data-f553c69ee7a1</li>
          <li>[7] Fidelity Investments. Leveraged ETFs. https://www.fidelity.com/learning-center/investment-products/etf/types-of-etfs-leveraged-etfs</li>
          <li>[8] ETF.com. Volatility ETFs: Everything You Need to Know. https://www.etf.com/sections/etf-basics/volatility-etfs-everything-you-need-know</li>
          <li>[9] Elm Wealth. (2025, April 15). Inverse-Double-Short-Leveraged ETFs Have Arrived! https://elmwealth.com/double-short-etf/</li>
          <li>[10] StockBrokers.com. (2025, April 17). After-Hours Trading: How it Works & Hours for Each Broker. https://www.stockbrokers.com/education/after-hours-trading</li>
          <li>[11] Ally. Manage Trading Losses & Market Drops. https://www.ally.com/stories/invest/manage-volatility-trading-losses/</li>
          <li>[12] YouTube. (2021, January 25). Ally Invest Stock Market Orders Explained. https://www.youtube.com/watch?v=P_z8Aw6ndh4</li>
          <li>[13] Charles Schwab. 3 Order Types: Market, Limit, and Stop Orders. https://www.schwab.com/learn/story/3-order-types-market-limit-and-stop-orders</li>
          <li>[14] Ally Invest. Customer Agreement. https://www.ally.com/content/dam/pdf/invest/customer-agreement.pdf</li>
          <li>[15] Quantified Strategies. 44 Types of Trading Orders. https://www.quantifiedstrategies.com/types-of-trading-orders/</li>
          <li>[16] Charles Schwab. Extended Hours Trading - Stocks. https://www.schwab.com/stocks/extended-hours-trading</li>
          <li>[17] Investrade. Extended Hours Trading. https://www.investrade.com/extended-hours/</li>
          <li>[18] Maoxian. (2024, July 19). Extended Hours Trading Hours for the Top 25 Retail Stock Brokers. https://www.maoxian.com/thoughts/extended-hours-trading-hours-for-the-top-25-retail-stock-brokers</li>
          <li>[19] ABET. Self-Study Templates. https://www.abet.org/accreditation/accreditation-criteria/self-study-templates/</li>
          <li>[20] ABET. (2024). Template for a Self-Study Report. https://www.abet.org/wp-content/uploads/2024/09/S002_ANSAC-Self-Study-Questionnaire_2025-2026.docx</li>
          <li>[22] ABET. Self-Study Report. https://www.abet.org/accreditation/get-accredited/accreditation-step-by-step/self-study-report/</li>
          <li>[23] Nashua Community College. (2022, July 1). NCC ABET Self Study 2022. https://nashuacc.edu/wp-content/uploads/2022/07/NCC-ABET-Self-Study-Report-6-29-2022-submitted.pdf</li>
        </ol>
      </section>
    </main>
  </div>

  <script>
    // Trade data storage
    let trades = [];
    let tradeIdCounter = 1;

    // Cookie helper functions
    function setCookie(name, value, days) {
      const expires = new Date();
      expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
      document.cookie = `${name}=${encodeURIComponent(value)};expires=${expires.toUTCString()};path=/`;
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
      }
      return null;
    }

    // Download trades as JSON
    function downloadTrades() {
      const data = {
        trades: trades,
        counter: tradeIdCounter,
        exportDate: new Date().toISOString(),
        version: '1.0'
      };
      
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `paper-trades-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('✅ Trades downloaded successfully!');
    }

    // Upload trades from JSON file
    function uploadTrades(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (!data.trades || !Array.isArray(data.trades)) {
            alert('❌ Invalid file format. Expected trades array.');
            return;
          }

          if (trades.length > 0) {
            if (!confirm('⚠️ This will replace your current trades. Continue?')) {
              return;
            }
          }

          trades = data.trades;
          tradeIdCounter = data.counter || trades.length + 1;
          
          saveTrades();
          renderTrades();
          
          alert(`✅ Successfully imported ${trades.length} trades!`);
        } catch (error) {
          alert('❌ Error reading file: ' + error.message);
        }
      };
      
      reader.readAsText(file);
      event.target.value = ''; // Reset file input
    }

    // Clear all trades
    function clearAllTrades() {
      if (!confirm('⚠️ Delete ALL trades? This cannot be undone!')) return;
      
      trades = [];
      tradeIdCounter = 1;
      saveTrades();
      renderTrades();
      
      alert('✅ All trades cleared.');
    }

    // Initialize with default trades
    function initializeDefaultTrades() {
      const defaultTrades = [
        { ticker: 'MSTU', action: 'BUY', shares: 100, price: 52.00, date: '2025-10-01', notes: 'Bull Rocket scenario - BTC rallying', pairedWith: null },
        { ticker: 'MSTU', action: 'SELL', shares: 100, price: 55.12, date: '2025-10-03', notes: 'Target hit +6%', pairedWith: null },
        { ticker: 'MSTR', action: 'BUY', shares: 50, price: 385.00, date: '2025-10-05', notes: 'Accumulation zone', pairedWith: null },
        { ticker: 'TSLL', action: 'BUY', shares: 200, price: 50.00, date: '2025-10-10', notes: 'Tesla earnings play', pairedWith: null },
        { ticker: 'TSLL', action: 'SELL', shares: 200, price: 53.00, date: '2025-10-11', notes: 'Quick +6% gain', pairedWith: null },
        { ticker: 'IBIT', action: 'BUY', shares: 150, price: 42.50, date: '2025-10-15', notes: 'Direct BTC exposure during ATM', pairedWith: null }
      ];
      
      defaultTrades.forEach(trade => {
        trades.push({ ...trade, id: tradeIdCounter++ });
      });
      
      // Auto-pair matching trades
      autoPairTrades();
      saveTrades();
      renderTrades();
    }

    // Auto-pair matching BUY/SELL trades
    function autoPairTrades() {
      const buyTrades = trades.filter(t => t.action === 'BUY' && !t.pairedWith);
      const sellTrades = trades.filter(t => t.action === 'SELL' && !t.pairedWith);
      
      buyTrades.forEach(buy => {
        const matchingSell = sellTrades.find(sell => 
          sell.ticker === buy.ticker && 
          sell.shares === buy.shares && 
          !sell.pairedWith &&
          new Date(sell.date) >= new Date(buy.date)
        );
        
        if (matchingSell) {
          buy.pairedWith = matchingSell.id;
          matchingSell.pairedWith = buy.id;
        }
      });
    }

    // Load trades from localStorage or cookie
    function loadTrades() {
      let saved = localStorage.getItem('paperTrades');
      
      // Fallback to cookie if localStorage is empty
      if (!saved) {
        saved = getCookie('paperTrades');
      }
      
      if (saved) {
        try {
          const data = JSON.parse(saved);
          trades = data.trades || [];
          tradeIdCounter = data.counter || 1;
        } catch (error) {
          console.error('Error loading trades:', error);
          initializeDefaultTrades();
        }
      } else {
        initializeDefaultTrades();
      }
    }

    // Save trades to both localStorage and cookie
    function saveTrades() {
      const data = JSON.stringify({
        trades: trades,
        counter: tradeIdCounter
      });
      
      // Save to localStorage
      try {
        localStorage.setItem('paperTrades', data);
      } catch (error) {
        console.error('localStorage error:', error);
      }
      
      // Save to cookie as backup (expires in 365 days)
      try {
        setCookie('paperTrades', data, 365);
      } catch (error) {
        console.error('Cookie error:', error);
      }
    }

    // Add new trade
    function addTrade() {
      const ticker = document.getElementById('ticker').value.toUpperCase().trim();
      const action = document.getElementById('action').value;
      const shares = parseInt(document.getElementById('shares').value);
      const price = parseFloat(document.getElementById('price').value);
      const date = document.getElementById('date').value;
      const notes = document.getElementById('notes').value.trim();

      if (!ticker || !shares || !price || !date) {
        alert('Please fill in all required fields (Ticker, Shares, Price, Date)');
        return;
      }

      const trade = {
        id: tradeIdCounter++,
        ticker,
        action,
        shares,
        price,
        date,
        notes,
        pairedWith: null
      };

      trades.push(trade);
      saveTrades();
      renderTrades();

      // Clear form
      document.getElementById('ticker').value = '';
      document.getElementById('shares').value = '';
      document.getElementById('price').value = '';
      document.getElementById('notes').value = '';
    }

    // Delete trade
    function deleteTrade(id) {
      if (!confirm('Delete this trade?')) return;
      
      const trade = trades.find(t => t.id === id);
      if (trade && trade.pairedWith) {
        const paired = trades.find(t => t.id === trade.pairedWith);
        if (paired) paired.pairedWith = null;
      }
      
      trades = trades.filter(t => t.id !== id);
      saveTrades();
      renderTrades();
    }

    // Edit trade
    function editTrade(id) {
      const trade = trades.find(t => t.id === id);
      if (!trade) return;

      const newTicker = prompt('Ticker:', trade.ticker);
      if (newTicker === null) return;
      
      const newShares = prompt('Shares:', trade.shares);
      if (newShares === null) return;
      
      const newPrice = prompt('Price:', trade.price);
      if (newPrice === null) return;
      
      const newDate = prompt('Date (YYYY-MM-DD):', trade.date);
      if (newDate === null) return;
      
      const newNotes = prompt('Notes:', trade.notes);
      if (newNotes === null) return;

      trade.ticker = newTicker.toUpperCase().trim();
      trade.shares = parseInt(newShares);
      trade.price = parseFloat(newPrice);
      trade.date = newDate;
      trade.notes = newNotes.trim();

      saveTrades();
      renderTrades();
    }

    // Pair trades
    function pairTrade(id) {
      const trade = trades.find(t => t.id === id);
      if (!trade) return;

      // Find unpaired trades of opposite action and same ticker
      const oppositeAction = trade.action === 'BUY' ? 'SELL' : 'BUY';
      const candidates = trades.filter(t => 
        t.action === oppositeAction && 
        t.ticker === trade.ticker && 
        !t.pairedWith &&
        t.id !== id
      );

      if (candidates.length === 0) {
        alert('No unpaired ' + oppositeAction + ' trades found for ' + trade.ticker);
        return;
      }

      const options = candidates.map(t => 
        `${t.id}: ${t.action} ${t.shares} @ $${t.price.toFixed(2)} on ${t.date}`
      ).join('\n');
      
      const selectedId = prompt('Select trade to pair with:\n\n' + options + '\n\nEnter trade ID:');
      if (!selectedId) return;

      const pairedTrade = candidates.find(t => t.id === parseInt(selectedId));
      if (!pairedTrade) {
        alert('Invalid trade ID');
        return;
      }

      // Unpair if already paired
      if (trade.pairedWith) {
        const oldPair = trades.find(t => t.id === trade.pairedWith);
        if (oldPair) oldPair.pairedWith = null;
      }
      if (pairedTrade.pairedWith) {
        const oldPair = trades.find(t => t.id === pairedTrade.pairedWith);
        if (oldPair) oldPair.pairedWith = null;
      }

      trade.pairedWith = pairedTrade.id;
      pairedTrade.pairedWith = trade.id;

      saveTrades();
      renderTrades();
    }

    // Unpair trade
    function unpairTrade(id) {
      const trade = trades.find(t => t.id === id);
      if (!trade || !trade.pairedWith) return;

      const paired = trades.find(t => t.id === trade.pairedWith);
      if (paired) paired.pairedWith = null;
      trade.pairedWith = null;

      saveTrades();
      renderTrades();
    }

    // Calculate P&L for paired trades
    function calculatePL(buyTrade, sellTrade) {
      const buyTotal = buyTrade.shares * buyTrade.price;
      const sellTotal = sellTrade.shares * sellTrade.price;
      const pl = sellTotal - buyTotal;
      const plPercent = (pl / buyTotal) * 100;
      return { pl, plPercent };
    }

    // Render trades
    function renderTrades() {
      const container = document.getElementById('trades-list');
      
      // Group trades by ticker
      const grouped = {};
      trades.forEach(trade => {
        if (!grouped[trade.ticker]) grouped[trade.ticker] = [];
        grouped[trade.ticker].push(trade);
      });

      let html = '';
      
      Object.keys(grouped).sort().forEach(ticker => {
        const tickerTrades = grouped[ticker].sort((a, b) => new Date(a.date) - new Date(b.date));
        
        html += `<div style="margin-bottom: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid rgba(245,158,11,0.2);">`;
        html += `<h5 style="margin: 0 0 10px 0; color: var(--gold); font-size: 1.2em;">📈 ${ticker}</h5>`;
        
        tickerTrades.forEach(trade => {
          const isPaired = trade.pairedWith !== null;
          const pairedTrade = isPaired ? trades.find(t => t.id === trade.pairedWith) : null;
          const actionColor = trade.action === 'BUY' ? '#4ade80' : '#f87171';
          
          html += `<div style="margin: 8px 0; padding: 12px; background: rgba(0,0,0,0.4); border-radius: 6px; border-left: 3px solid ${actionColor};">`;
          html += `<div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;">`;
          html += `<div style="flex: 1; min-width: 200px;">`;
          html += `<strong style="color: ${actionColor};">${trade.action}</strong> `;
          html += `<span style="color: var(--text);">${trade.shares} shares @ $${trade.price.toFixed(2)}</span>`;
          html += `<br><small style="color: var(--muted);">📅 ${trade.date} | Total: $${(trade.shares * trade.price).toFixed(2)}</small>`;
          
          if (trade.notes) {
            html += `<br><small style="color: var(--muted); font-style: italic;">💭 ${trade.notes}</small>`;
          }
          
          if (isPaired && pairedTrade) {
            const buyTrade = trade.action === 'BUY' ? trade : pairedTrade;
            const sellTrade = trade.action === 'SELL' ? trade : pairedTrade;
            const { pl, plPercent } = calculatePL(buyTrade, sellTrade);
            const plColor = pl >= 0 ? '#4ade80' : '#f87171';
            html += `<br><strong style="color: ${plColor};">🔗 Paired | P&L: $${pl.toFixed(2)} (${plPercent >= 0 ? '+' : ''}${plPercent.toFixed(2)}%)</strong>`;
          }
          
          html += `</div>`;
          html += `<div style="display: flex; gap: 5px; flex-wrap: wrap;">`;
          html += `<button onclick="editTrade(${trade.id})" style="padding: 5px 10px; background: rgba(232,160,48,0.2); color: var(--gold); border: 1px solid var(--gold); border-radius: 4px; cursor: pointer; font-size: 12px;">✏️ Edit</button>`;
          
          if (isPaired) {
            html += `<button onclick="unpairTrade(${trade.id})" style="padding: 5px 10px; background: rgba(248,113,113,0.2); color: #f87171; border: 1px solid #f87171; border-radius: 4px; cursor: pointer; font-size: 12px;">🔓 Unpair</button>`;
          } else {
            html += `<button onclick="pairTrade(${trade.id})" style="padding: 5px 10px; background: rgba(74,222,128,0.2); color: #4ade80; border: 1px solid #4ade80; border-radius: 4px; cursor: pointer; font-size: 12px;">🔗 Pair</button>`;
          }
          
          html += `<button onclick="deleteTrade(${trade.id})" style="padding: 5px 10px; background: rgba(248,113,113,0.2); color: #f87171; border: 1px solid #f87171; border-radius: 4px; cursor: pointer; font-size: 12px;">🗑️ Delete</button>`;
          html += `</div>`;
          html += `</div>`;
          html += `</div>`;
        });
        
        html += `</div>`;
      });

      container.innerHTML = html || '<p style="color: var(--muted);">No trades yet. Add your first trade above!</p>';
      
      renderSummary();
    }

    // Render summary
    function renderSummary() {
      const summary = document.getElementById('summary-content');
      
      // Calculate stats
      const totalTrades = trades.length;
      const pairedTrades = trades.filter(t => t.pairedWith !== null);
      const completedPairs = pairedTrades.length / 2;
      
      let totalPL = 0;
      let winningTrades = 0;
      let losingTrades = 0;
      
      const processed = new Set();
      pairedTrades.forEach(trade => {
        if (processed.has(trade.id)) return;
        
        const paired = trades.find(t => t.id === trade.pairedWith);
        if (!paired) return;
        
        const buyTrade = trade.action === 'BUY' ? trade : paired;
        const sellTrade = trade.action === 'SELL' ? trade : paired;
        const { pl } = calculatePL(buyTrade, sellTrade);
        
        totalPL += pl;
        if (pl > 0) winningTrades++;
        else if (pl < 0) losingTrades++;
        
        processed.add(trade.id);
        processed.add(paired.id);
      });
      
      const winRate = completedPairs > 0 ? (winningTrades / completedPairs * 100) : 0;
      const plColor = totalPL >= 0 ? '#4ade80' : '#f87171';
      
      let html = `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">`;
      html += `<div><strong>Total Trades:</strong> ${totalTrades}</div>`;
      html += `<div><strong>Completed Pairs:</strong> ${completedPairs}</div>`;
      html += `<div><strong>Win Rate:</strong> ${winRate.toFixed(1)}% (${winningTrades}W / ${losingTrades}L)</div>`;
      html += `<div><strong style="color: ${plColor};">Total P&L:</strong> <span style="color: ${plColor}; font-size: 1.2em;">${totalPL >= 0 ? '+' : ''}$${totalPL.toFixed(2)}</span></div>`;
      html += `</div>`;
      
      summary.innerHTML = html;
    }

    // Set today's date as default
    document.getElementById('date').valueAsDate = new Date();

    // Initialize on load
    loadTrades();
    renderTrades();
  </script>
</body>
</html>
